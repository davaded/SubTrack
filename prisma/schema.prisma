// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id               Int            @id @default(autoincrement())
  email            String         @unique
  password         String
  name             String?

  // Role and Status
  role             String         @default("user") // user | admin
  status           String         @default("pending") // pending | active | suspended

  // Approval tracking
  approvedBy       Int?           @map("approved_by")
  approvedAt       DateTime?      @map("approved_at")

  // Security
  mustChangePassword Boolean      @default(false) @map("must_change_password")
  lastLoginAt      DateTime?      @map("last_login_at")

  defaultCurrency  String         @default("USD") @map("default_currency")
  createdAt        DateTime       @default(now()) @map("created_at")
  updatedAt        DateTime       @updatedAt @map("updated_at")
  subscriptions    Subscription[]

  @@index([role])
  @@index([status])
  @@map("users")
}

model Subscription {
  id                 Int      @id @default(autoincrement())
  userId             Int      @map("user_id")
  name               String
  amount             Float
  currency           String   @default("USD")
  billingCycle       String   @map("billing_cycle")
  customCycleDays    Int?     @map("custom_cycle_days")
  firstBillingDate   DateTime @map("first_billing_date")
  nextBillingDate    DateTime @map("next_billing_date")
  category           String?
  websiteUrl         String?  @map("website_url")
  logoUrl            String?  @map("logo_url")
  notes              String?
  remindDaysBefore   Int      @default(3) @map("remind_days_before")
  isActive           Boolean  @default(true) @map("is_active")
  createdAt          DateTime @default(now()) @map("created_at")
  updatedAt          DateTime @updatedAt @map("updated_at")

  user               User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([nextBillingDate])
  @@index([isActive])
  @@map("subscriptions")
}

model SystemSettings {
  id                 Int      @id @default(1)

  // Registration settings
  registrationMode   String   @default("approval") @map("registration_mode") // open | approval | closed

  // Site settings
  siteName           String   @default("SubTrack") @map("site_name")
  maxUsersLimit      Int?     @map("max_users_limit")

  createdAt          DateTime @default(now()) @map("created_at")
  updatedAt          DateTime @updatedAt @map("updated_at")

  @@map("system_settings")
}
